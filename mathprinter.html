<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Printable First Grade Math Generator</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            max-width: 900px;
            margin: 0 auto;
            background-color: #f4f4f9;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .config-section { 
            margin-bottom: 25px; 
            padding: 15px; 
            border: 1px solid #bdc3c7; 
            border-radius: 8px; 
            background-color: #ffffff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .config-section label {
            margin-right: 20px;
            cursor: pointer;
            font-size: 1.05em;
        }
        button {
            padding: 10px 15px;
            margin-right: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        #max-pages-btn {
            background-color: #f39c12;
            color: white;
        }
        #max-pages-btn:hover {
            background-color: #e67e22;
        }
        #generate-btn {
            background-color: #2ecc71;
            color: white;
            font-size: 1.1em;
            padding: 12px 20px;
        }
        #generate-btn:hover {
            background-color: #27ae60;
        }
        #download-pdf-btn {
            background-color: #3498db;
            color: white;
            font-size: 1.1em;
            padding: 12px 20px;
            display: none; /* Hide until equations are generated */
        }
        #download-pdf-btn:hover {
            background-color: #2980b9;
        }
        
        /* Preview Styling - Shows a layout that roughly mimics the PDF */
        #preview-area {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #ccc;
        }
        .page-preview {
            border: 1px solid #333;
            width: 595px; /* A4 width */
            height: 842px; /* A4 height */
            margin: 20px auto;
            padding: 30px;
            background-color: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            overflow: hidden; 
        }
        .equation-grid {
            /* 10 rows and 6 columns, perfectly matching the 60 problems per page */
            display: grid;
            grid-template-columns: repeat(6, 1fr); 
            /* Distribute problems vertically from near the top to near the bottom */
            grid-template-rows: repeat(10, 1fr); 
            height: 100%; /* Fill the preview height */
            font-size: 14pt; /* Smaller font for better fit */
        }
        .equation {
            /* Left justified within its column */
            text-align: left; 
            padding: 0 5px;
            line-height: 1.2;
        }
    </style>
</head>
<body>

    <h1>ðŸ§  Printable Math Worksheet Generator</h1>

    <div id="range-section" class="config-section">
        <h3>1. Select Number Range:</h3>
        <label><input type="radio" name="range" value="0-10" checked> 0-10</label>
        <label><input type="radio" name="range" value="10-20"> 10-20</label>
        <label><input type="radio" name="range" value="0-20"> 0-20</label>
        <label><input type="radio" name="range" value="0-100"> 0-100</label>
    </div>

    <div id="operation-section" class="config-section">
        <h3>2. Select Operations:</h3>
        <label><input type="checkbox" id="add-op" checked> Addition (+)</label>
        <label><input type="checkbox" id="sub-op"> Subtraction (-)</label>
        <label><input type="checkbox" id="both-op"> Both (+ and -)</label>
    </div>

    <div id="page-section" class="config-section">
        <h3>3. Number of Pages (60 Equations per page):</h3>
        <input type="number" id="page-count" value="1" min="1" style="width: 60px; padding: 5px;">
        <button id="max-pages-btn">Calculate Max Combinations</button>
        <p><small>Max combinations: <span id="max-combinations">121 equations / 3 pages (for 0-10)</span></small></p>
    </div>

    <button id="generate-btn">Generate & Preview Pages</button>
    <button id="download-pdf-btn">Download PDF</button>

    <div id="preview-area">
        <h3>4. Preview (First Page Only)</h3>
        <div id="math-preview" class="page-preview">
            <p style="text-align: center; color: #555;">Click "Generate & Preview Pages" to see the worksheet.</p>
        </div>
    </div>

    <script>
        const EQUATIONS_PER_PAGE = 60;
        const generateBtn = document.getElementById('generate-btn');
        const downloadPdfBtn = document.getElementById('download-pdf-btn');
        const mathPreview = document.getElementById('math-preview');
        const maxPagesBtn = document.getElementById('max-pages-btn');

        // Helper to get random number in a range [min, max]
        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // Generates a single math problem based on the rules
        function generateProblem(opType, minVal, maxVal) {
            let num1, num2, operator;

            if (opType === '+') {
                operator = '+';
                // 5+6 and 6+5 are distinct
                num1 = getRandomInt(minVal, maxVal);
                num2 = getRandomInt(minVal, maxVal);
            } else if (opType === '-') {
                operator = '-';
                // Ensure result is positive or zero (larger number first)
                let a = getRandomInt(minVal, maxVal);
                let b = getRandomInt(minVal, maxVal);
                num1 = Math.max(a, b); 
                num2 = Math.min(a, b); 
            } else {
                return null;
            }
            
            // Format: num1 operator num2 = 
            // Note: We only generate the equation here; the answer line is drawn in the PDF logic.
            return `${num1} ${operator} ${num2}`;
        }

        // Main function to generate all required equations
        function generateEquations(minRange, maxRange, operations, numPages) {
            const totalEquations = numPages * EQUATIONS_PER_PAGE;
            const problems = [];
            const opTypes = [];
            
            if (operations.add) opTypes.push('+');
            if (operations.sub) opTypes.push('-');
            
            if (opTypes.length === 0) return [];

            for (let i = 0; i < totalEquations; i++) {
                // Randomly select an operation
                const op = opTypes[getRandomInt(0, opTypes.length - 1)];
                const problem = generateProblem(op, minRange, maxRange);
                problems.push(problem);
            }
            return problems;
        }

        // THE CRITICAL PDF GENERATION FUNCTION (Updated for layout)
        function createPDF(allEquations, numPages, minRange, maxRange) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({ unit: 'pt', format: 'a4' });
            
            const margin = 36; // 0.5 inch margin (top/bottom/left/right)
            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            const columnCount = 6;
            const rowCount = 10; // 60 equations / 6 columns = 10 rows
            
            const contentWidth = pageWidth - 2 * margin;
            const equationWidth = contentWidth / columnCount; // Width of each column
            
            // Vertical spacing to nicely fill the page
            const startY = margin + 30; // Start below the title
            const contentHeight = pageHeight - startY - margin;
            const equationHeight = contentHeight / rowCount; 

            doc.setFont('helvetica', 'normal');
            doc.setTextColor(0, 0, 0); // Black

            for (let pageNum = 0; pageNum < numPages; pageNum++) {
                if (pageNum > 0) {
                    doc.addPage();
                }

                const pageEquations = allEquations.slice(
                    pageNum * EQUATIONS_PER_PAGE, 
                    (pageNum + 1) * EQUATIONS_PER_PAGE
                );

                // Page Title
                doc.setFontSize(18);
                doc.text(`Math Worksheet (Range: ${minRange}-${maxRange})`, pageWidth / 2, margin + 10, { align: 'center' });
                doc.line(margin, margin + 15, pageWidth - margin, margin + 15);

                doc.setFontSize(12); // Reduced font size for better fit
                
                pageEquations.forEach((eq, index) => {
                    const col = index % columnCount;
                    const row = Math.floor(index / columnCount);

                    // X-coordinate: Left-align text within its column
                    const x = margin + (col * equationWidth); 
                    // Y-coordinate: Vertical position based on row
                    const y = startY + (row * equationHeight);
                    
                    // 1. Draw the Equation (Left Justified)
                    doc.text(`${eq} =`, x, y, { align: 'left' });
                    
                    // 2. Draw the Answer Line (Line to write the answer)
                    const lineY = y + 2; 
                    const lineStartX = x + doc.getTextWidth(`${eq} = `) + 5; // Start line after the equals sign
                    const lineLength = 20; // Length of the answer line
                    const lineEndX = lineStartX + lineLength; 
                    
                    doc.line(lineStartX, lineY, lineEndX, lineY); 
                });
                
                // Page Number
                doc.setFontSize(10);
                doc.text(`Page ${pageNum + 1} of ${numPages}`, pageWidth / 2, pageHeight - 15, { align: 'center' });
            }

            doc.save(`math_worksheet_${minRange}-${maxRange}.pdf`);
        }
        
        // --- Main Controller Function ---
        function generateAndPreview() {
            // 1. Get User Input
            const selectedRange = document.querySelector('input[name="range"]:checked').value;
            const [minRange, maxRange] = selectedRange.split('-').map(Number);
            
            const operations = {
                add: document.getElementById('add-op').checked,
                sub: document.getElementById('sub-op').checked
            };
            
            const numPages = parseInt(document.getElementById('page-count').value) || 1;
            
            // 2. Generate Equations
            const allEquations = generateEquations(minRange, maxRange, operations, numPages);
            
            // 3. Update Preview (Show only the first page's equations)
            mathPreview.innerHTML = '';
            const equationGrid = document.createElement('div');
            equationGrid.className = 'equation-grid';

            allEquations.slice(0, EQUATIONS_PER_PAGE).forEach(eq => {
                const div = document.createElement('div');
                div.className = 'equation';
                // Add the equals sign here for preview clarity
                div.textContent = `${eq} = ________`; 
                equationGrid.appendChild(div);
            });

            mathPreview.appendChild(equationGrid);
            downloadPdfBtn.style.display = 'inline-block';

            // 4. Set up Download Button with generated data
            downloadPdfBtn.onclick = () => createPDF(allEquations, numPages, minRange, maxRange);
        }

        // --- Event Listeners and Max Combinations ---

        generateBtn.addEventListener('click', generateAndPreview);

        document.getElementById('both-op').addEventListener('change', (e) => {
            const isChecked = e.target.checked;
            document.getElementById('add-op').checked = isChecked;
            document.getElementById('sub-op').checked = isChecked;
            document.getElementById('add-op').disabled = isChecked;
            document.getElementById('sub-op').disabled = isChecked;
        });

        maxPagesBtn.addEventListener('click', () => {
            const selectedRange = document.querySelector('input[name="range"]:checked').value;
            const [min, max] = selectedRange.split('-').map(Number);
            
            let totalCombinations = 0;
            const count = max - min + 1;

            // Addition: A+B, B+A are distinct. Total = count * count
            totalCombinations += count * count; 
            
            // Subtraction: A-B where A >= B. Total combinations = (n+1) * n / 2 where n is the number of integers.
            for (let a = min; a <= max; a++) {
                for (let b = min; b <= max; b++) {
                    if (a >= b) {
                        totalCombinations++; 
                    }
                }
            }
            
            const maxPages = Math.ceil(totalCombinations / EQUATIONS_PER_PAGE);
            document.getElementById('max-combinations').textContent = 
                `${totalCombinations.toLocaleString()} equations / ${maxPages} pages`;
            document.getElementById('page-count').value = maxPages;
        });
        
        // Initial max combinations calculation for 0-10 on load
        document.addEventListener('DOMContentLoaded', () => {
            const min = 0;
            const max = 10;
            const count = max - min + 1;
            let totalCombinations = count * count;
            for (let a = min; a <= max; a++) {
                for (let b = min; b <= max; b++) {
                    if (a >= b) {
                        totalCombinations++; 
                    }
                }
            }
            const maxPages = Math.ceil(totalCombinations / EQUATIONS_PER_PAGE);
             document.getElementById('max-combinations').textContent = 
                `${totalCombinations} equations / ${maxPages} pages (for 0-10)`;
        });

    </script>
</body>
</html>
